/* CSS para generar un PDF para lectura en pantalla.
   Basado en la plantilla legacy docs/templates/pdf.css
   
   Características:
   - Tamaño de página portada: 148mm x 210mm (A5)
   - Sin distinción de página izquierda/derecha para márgenes
   - Imagen de portada a sangre
*/

@media print {

    :root {
        /* Tipografía base */
        --body-font-family: 'Garamond', 'Noto Serif', serif;
        --body-font-size: 12pt;
        --body-line-height: 1.15;

        /* Control de composición */
        --paragraph-orphans: 3;
        --paragraph-widows: 3;
        --first-paragraph-widows: 4;
        --section-last-paragraph-orphans: 3;
        --section-last-paragraph-widows: 4;

        /* Alineaciones */
        --colophon-page-justify: flex-end;
        --colophon-page-text-align: center;
        --colophon-page-text-align: center;
        --metadata-text-align: left;
        /* Legacy variable, kept for compatibility if needed */

        /* Copyright / Metadata */
        --copyright-text-align: left;
        --copyright-font-size: 0.6rem;
        --copyright-justify: flex-end;
        --title-font-variant: normal;
        --author-font-variant: small-caps;
        --h1-text-align: center;
        --h2-text-align: center;

        /* Numeración */
        --page-number-content-center: counter(page);

        /* Dedicatoria */
        --dedication-page-justify: center;
        --dedication-page-text-align: right;
        --dedication-font-style: italic;

        /* Epígrafe */
        --epigraph-page-justify: flex-start;
        --epigraph-page-text-align: left;
        --epigraph-font-style: normal;

        /* Portada (Title Page) */
        --title-page-margin-top: 25%;
        --title-page-margin-bottom: 5%;
        --title-page-max-width: 80%;
    }

    /* Reglas generales de página (A5) */
    @page {
        size: 148mm 210mm;
        margin: 0;
    }

    /* Portada (imagen) - Usamos :first para evitar salto de página inicial */
    @page: first {
        margin: 0;
        padding: 0;
    }

    /* Página de título (texto) */
    @page title-page {
        margin: 0;
        box-sizing: border-box;

        @bottom-center {
            content: none;
        }
    }

    /* Páginas de contenido */
    @page content-pages {
        margin-top: 26mm;
        margin-bottom: 26mm;
        margin-left: 14mm;
        margin-right: 14mm;

        @bottom-center {
            content: var(--page-number-content-center);
            font-size: 10pt;
        }
    }

    /* Página final */
    @page colophon-page {
        margin: 0;
        padding: 0;
    }

    @page dedication-page {
        margin: 0;
        padding: 0;
    }

    @page epigraph-page {
        margin: 0;
        padding: 0;
    }

    /* Página de TOC (Tabla de Contenidos) - Sin numeración, márgenes estándar */
    @page toc-page {
        margin-top: 26mm;
        margin-bottom: 26mm;
        margin-left: 14mm;
        margin-right: 14mm;

        @bottom-center {
            content: none;
        }
    }

    /* ASIGNACIÓN DE ESTILOS DE PÁGINA */

    /* Imagen de portada */
    .cover-image {
        /* page: cover-page; <-- Eliminado para evitar salto */
        width: 148mm;
        height: 210mm;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        page-break-inside: avoid;
        break-inside: avoid;
        position: relative;
        overflow: hidden;
    }

    .cover-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Header con metadatos -> Página de título */
    header:has(.metadata>p),
    header:has(.title_and_authors) {
        page: content-pages;
        /* height: 210mm;  <-- REMOVED to allow auto height */
        /* padding: 26mm 14mm 26mm 14mm; <-- REMOVED, handled by specific rules */
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        text-align: center;
    }

    /* Tabla de Contenidos */
    nav#TOC {
        page: toc-page;
        break-before: page;
    }

    nav#TOC h1 {
        text-align: center;
        font-size: 1.3em;
        font-weight: normal;
        font-variant: small-caps;
        margin-bottom: 1.5em;
        margin-top: 0;
    }

    nav#TOC ul.toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    nav#TOC ul.toc-list li {
        position: relative;
        margin-bottom: 0.4em;
        line-height: 1.4;
    }

    nav#TOC ul.toc-list li a {
        display: block;
        position: relative;
        text-decoration: none;
        color: inherit;
    }

    /* Leader dots usando pseudo-elemento */
    nav#TOC ul.toc-list li a::before {
        content: ".................................................................................................................";
        text-align: right;
        color: #bbb;
        letter-spacing: 2px;
        width: 100%;
        font-size: 0.8em;
        position: absolute;
        bottom: 0.15em;
        left: 0;
        overflow: hidden;
        z-index: 0;
    }

    nav#TOC ul.toc-list li a .toc-text {
        position: relative;
        z-index: 1;
        background: white;
        padding-right: 0.3em;
    }

    /* Número de página al final (target-counter) */
    nav#TOC ul.toc-list li a::after {
        content: target-counter(attr(href url), page);
        position: absolute;
        right: 0;
        bottom: 0;
        background: white;
        padding-left: 0.3em;
        z-index: 1;
    }

    /* TOC level indentation */
    nav#TOC ul.toc-list li.toc-level-2 {
        padding-left: 1.5em;
    }

    nav#TOC ul.toc-list li.toc-level-3 {
        padding-left: 3em;
    }

    /* Contenido principal */
    .main-content {
        page: content-pages;
    }

    /* Colofón */
    /* Colofón */
    .colophon {
        page: colophon-page;
        min-height: 210mm;
        padding: 12mm 8mm 12mm 8mm;
        box-sizing: border-box;
        font-size: small;
        display: flex;
        flex-direction: column;
        justify-content: var(--colophon-page-justify);
        text-align: var(--colophon-page-text-align);
        hyphens: none;
    }

    .colophon p {
        text-align: var(--colophon-page-text-align);
        text-indent: 0;
        margin-bottom: 1em;
        hyphens: none;
    }

    .colophon h1 {
        display: none;
    }

    /* Dedicatoria */
    .dedication {
        page: dedication-page;
        min-height: 210mm;
        padding: 25% 8mm 12mm 8mm;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        text-align: var(--dedication-page-text-align);
        font-style: var(--dedication-font-style);
    }

    .dedication h1 {
        display: none;
    }

    .dedication p {
        text-align: var(--dedication-page-text-align);
        text-indent: 0;
        max-width: 60%;
        margin-left: auto;
        margin-right: 15%;
    }

    /* Epígrafe */
    .epigraph {
        page: epigraph-page;
        min-height: 210mm;
        padding: 12mm 8mm 12mm 8mm;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: var(--epigraph-page-justify);
        text-align: var(--epigraph-page-text-align);
        font-style: var(--epigraph-font-style);
    }

    .epigraph h1 {
        display: none;
    }

    .epigraph p {
        text-align: var(--epigraph-page-text-align);
        text-indent: 0;
    }

    /* ESTILOS DE TEXTO */

    body {
        line-height: var(--body-line-height);
        font-size: var(--body-font-size);
        font-family: var(--body-font-family);
        hyphens: auto;
        margin: 0;
        padding: 0;
    }

    /* Title Page - Modo compacto por defecto (sin publisher) */
    /* Header: Siempre es página de título completa (controlado por template) */
    header {
        page: title-page;
        height: 100%;
        padding-top: var(--title-page-margin-top);
        padding-bottom: var(--title-page-margin-bottom);
        break-after: page;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    /* Regla legacy eliminada: header:has(.publisher)... ya no es necesaria */

    header .title_and_authors {
        width: 100%;
        max-width: var(--title-page-max-width);
    }

    /* En modo completo, empuja title_and_authors hacia arriba */
    header:has(.publisher) .title_and_authors {
        margin-bottom: auto;
    }

    header .title {
        font-variant: var(--title-font-variant);
        font-size: 150%;
    }

    header .author {
        font-variant: var(--author-font-variant);
        margin-top: 1rem;
    }

    header .publisher {
        width: 100%;
        max-width: var(--title-page-max-width);
        margin-bottom: 1.5rem;
        font-variant: small-caps;
        font-size: 0.9rem;
    }

    header .metadata {
        width: 60%;
        margin-left: auto;
        margin-right: auto;
        margin-top: 2rem;
        font-size: var(--copyright-font-size);
        text-align: center;
    }

    header .metadata p {
        text-align: center;
        text-indent: 0;
        margin: 0;
    }

    h1 {
        text-align: var(--h1-text-align);
        font-size: 1.8em;
        font-weight: normal;
        margin-top: 2em;
        margin-bottom: 1em;
    }

    h2 {
        text-align: var(--h2-text-align);
        font-size: 1.4em;
        font-weight: normal;
        margin-top: 1.5em;
        margin-bottom: 0.75em;
    }

    h3 {
        text-align: left;
        font-size: 1.1em;
        font-weight: bold;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
    }

    h4 {
        text-align: left;
        font-size: 1em;
        font-style: italic;
        margin-top: 1.2em;
        margin-bottom: 0.4em;
    }

    h5 {
        text-align: left;
        font-size: 1em;
        font-weight: bold;
        margin-top: 1em;
        margin-bottom: 0.3em;
    }

    h6 {
        text-align: left;
        font-size: 1em;
        font-variant: small-caps;
        font-weight: normal;
        margin-top: 1em;
        margin-bottom: 0.3em;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        page-break-after: avoid;
        break-after: avoid;
    }

    h1+h2 {
        break-before: avoid;
    }

    section {
        break-before: page;
    }

    strong,
    b {
        font-variant: small-caps;
        font-weight: normal;
    }

    /* =========================================
       CONTROL DE PAGINACIÓN (VIUDAS Y HUÉRFANAS)
       ========================================= */

    /* Caso C: Párrafos intermedios (Regla general balanceada) */
    p {
        orphans: 2 !important;
        widows: 2 !important;
        text-align: justify;
    }

    /* Caso B: Último párrafo de bloque (antes de separador o cambio de sección)
       Prioridad: Evitar pocas líneas sueltas al INICIO de la nueva página.
       Efecto: Párrafos cortos (< 4 líneas) saltarán enteros a la siguiente página. */
    p:not(:has(+ p)) {
        orphans: 2 !important;
        widows: 4 !important;
    }

    /* Caso A: Primer párrafo de bloque (después de título o separador) 
       Prioridad: Evitar dejar pocas líneas sueltas al FINAL de la página anterior. */
    hr + p,
    h1 + p,
    h2 + p {
        orphans: 4 !important;
        widows: 2 !important;
    }

    /* Sangría */
    main p {
        margin: 0;
        text-indent: 0;
    }

    main p+p {
        text-indent: 1.5em;
    }

    /* Estilo alternativo: párrafos separados sin sangría */
    body.paragraph-spaced {
        main p {
            margin-bottom: 1em;
        }
        
        /* no solo p+p, porque entonces no se aplicaría tras un salto de página */
        main p {
            text-indent: 0 !important;
        }
    }

    hr,
    .hr {
        border: 0;
        height: 1rem;
    }

    img {
        max-width: 100%;
    }

    /* Ocultar elementos no listados */
    .unlisted {
        display: none;
    }

    /* Made With Page */
    .made-with-page {
        break-before: page;
        height: 100%;
        /* Changed from 100vh to 100% */
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: center;
        text-align: center;
        padding-bottom: 3rem;
        box-sizing: border-box;
    }

    .made-with-logo {
        width: 24px;
        /* Smaller */
        height: auto;
        margin-bottom: 1rem;
        opacity: 0.8;
    }

    .made-with-text {
        font-size: 0.8rem;
        color: #888;
        margin: 0;
    }
}

/* ESTILOS INTERFAZ PAGED.JS (PREVIEW) */
@media screen,
pagedjs-ignore {
    body {
        background-color: gray;
    }

    .pagedjs_page {
        background-color: white;
        box-shadow: 0 0 0 1px #cfcfcf;
        margin: 10mm auto;
    }

    .pagedjs_first_page {
        margin-left: auto;
        /* Centrado para single-page view */
    }
}