/* CSS para generar un PDF para lectura en pantallas móviles.
   Basado en screen.css pero optimizado para dispositivos pequeños.
   
   Características:
   - Tamaño de página vertical optimizado para móviles (aspect ratio 9:16)
   - Tipografía más grande para mejor legibilidad
   - Márgenes reducidos para aprovechar el espacio
*/

@media print {

    :root {
        /* Tipografía base - Optimizada para móviles */
        --body-font-family: 'Garamond', 'Noto Serif', serif;
        --body-font-size: 10pt;
        --body-line-height: 1.25;

        /* Control de composición */
        --paragraph-orphans: 2;
        --paragraph-widows: 2;
        --first-paragraph-widows: 3;
        --section-last-paragraph-orphans: 2;
        --section-last-paragraph-widows: 3;

        /* Alineaciones */
        --colophon-page-justify: flex-end;
        --colophon-page-text-align: center;
        --colophon-page-text-align: center;
        --metadata-text-align: left;

        /* Copyright / Metadata */
        --copyright-text-align: left;
        --copyright-font-size: 0.7rem;
        --copyright-justify: flex-end;
        --title-font-variant: normal;
        --author-font-variant: small-caps;
        --h1-text-align: center;
        --h2-text-align: center;

        /* Numeración */
        --page-number-content-center: counter(page);

        /* Dedicatoria */
        --dedication-page-justify: center;
        --dedication-page-text-align: right;
        --dedication-font-style: italic;

        /* Epígrafe */
        --epigraph-page-justify: flex-start;
        --epigraph-page-text-align: left;
        --epigraph-font-style: normal;

        /* Portada (Title Page) */
        --title-page-margin-top: 35%;
        --title-page-margin-bottom: 10%;
        --title-page-max-width: 90%;
    }

    /* Reglas generales de página - Formato vertical móvil (9:16) */
    @page {
        size: 90mm 160mm;
        margin: 0;
    }

    /* Portada (imagen) - Usamos :first para evitar salto de página inicial */
    @page: first {
        margin: 0;
        padding: 0;
    }

    /* Página de título (texto) */
    @page title-page {
        margin: 0;
        box-sizing: border-box;

        @bottom-center {
            content: none;
        }
    }

    /* Páginas de contenido - Márgenes reducidos para móviles */
    @page content-pages {
        margin-top: 12mm;
        margin-bottom: 12mm;
        margin-left: 8mm;
        margin-right: 8mm;

        @bottom-center {
            content: var(--page-number-content-center);
            font-size: 9pt;
        }
    }

    /* Página final */
    @page colophon-page {
        margin: 0;
        padding: 0;
    }

    @page dedication-page {
        margin: 0;
        padding: 0;
    }

    @page epigraph-page {
        margin: 0;
        padding: 0;
    }

    /* Página de TOC (Tabla de Contenidos) - Sin numeración, márgenes estándar */
    @page toc-page {
        margin-top: 12mm;
        margin-bottom: 12mm;
        margin-left: 8mm;
        margin-right: 8mm;

        @bottom-center {
            content: none;
        }
    }

    /* ASIGNACIÓN DE ESTILOS DE PÁGINA */

    /* Imagen de portada */
    .cover-image {
        /* page: cover-page; <-- Eliminado para evitar salto */
        width: 90mm;
        height: 160mm;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        page-break-inside: avoid;
        break-inside: avoid;
        position: relative;
        overflow: hidden;
    }

    .cover-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Header con metadatos - Sin page: asignado para que fluya con el contenido en modo compacto */
    header:has(.metadata>p),
    header:has(.title_and_authors) {
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        text-align: center;
    }

    /* Tabla de Contenidos */
    nav#TOC {
        page: toc-page;
        break-before: page;
    }

    nav#TOC h1 {
        text-align: center;
        font-size: 1.2em;
        font-weight: normal;
        font-variant: small-caps;
        margin-bottom: 1.2em;
        margin-top: 0;
    }

    nav#TOC ul.toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    nav#TOC ul.toc-list li {
        position: relative;
        margin-bottom: 0.35em;
        line-height: 1.3;
        font-size: 0.95em;
    }

    nav#TOC ul.toc-list li a {
        display: block;
        position: relative;
        text-decoration: none;
        color: inherit;
    }

    /* Leader dots usando pseudo-elemento */
    nav#TOC ul.toc-list li a::before {
        content: ".................................................................................................................";
        text-align: right;
        color: #bbb;
        letter-spacing: 1.5px;
        width: 100%;
        font-size: 0.75em;
        position: absolute;
        bottom: 0.1em;
        left: 0;
        overflow: hidden;
        z-index: 0;
    }

    nav#TOC ul.toc-list li a .toc-text {
        position: relative;
        z-index: 1;
        background: white;
        padding-right: 0.2em;
    }

    /* Número de página al final (target-counter) */
    nav#TOC ul.toc-list li a::after {
        content: target-counter(attr(href url), page);
        position: absolute;
        right: 0;
        bottom: 0;
        background: white;
        padding-left: 0.2em;
        z-index: 1;
    }

    /* TOC level indentation */
    nav#TOC ul.toc-list li.toc-level-2 {
        padding-left: 1em;
    }

    nav#TOC ul.toc-list li.toc-level-3 {
        padding-left: 2em;
    }

    /* Contenido principal */
    .main-content {
        page: content-pages;
    }

    /* Colofón */
    .colophon {
        page: colophon-page;
        min-height: 160mm;
        padding: 12mm 8mm 12mm 8mm;
        box-sizing: border-box;
        font-size: small;
        display: flex;
        flex-direction: column;
        justify-content: var(--colophon-page-justify);
        text-align: var(--colophon-page-text-align);
        hyphens: none;
    }

    .colophon p {
        text-align: var(--colophon-page-text-align);
        text-indent: 0;
        margin-bottom: 1em;
        hyphens: none;
    }

    .colophon h1 {
        display: none;
    }

    /* Dedicatoria */
    .dedication {
        page: dedication-page;
        min-height: 160mm;
        padding: 30% 8mm 12mm 8mm;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        text-align: var(--dedication-page-text-align);
        font-style: var(--dedication-font-style);
    }

    .dedication h1 {
        display: none;
    }

    .dedication p {
        text-align: var(--dedication-page-text-align);
        text-indent: 0;
        max-width: 80%;
        margin-left: auto;
        margin-right: 10%;
    }

    /* Epígrafe */
    .epigraph {
        page: epigraph-page;
        min-height: 160mm;
        padding: 12mm 8mm 12mm 8mm;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: var(--epigraph-page-justify);
        text-align: var(--epigraph-page-text-align);
        font-style: var(--epigraph-font-style);
    }

    .epigraph h1 {
        display: none;
    }

    .epigraph p {
        text-align: var(--epigraph-page-text-align);
        text-indent: 0;
    }

    /* ESTILOS DE TEXTO */

    body {
        line-height: var(--body-line-height);
        font-size: var(--body-font-size);
        font-family: var(--body-font-family);
        hyphens: auto;
        margin: 0;
        padding: 0;
    }

    /* Title Page - Modo compacto por defecto (sin publisher) */
    /* Header: Siempre es página de título completa (controlado por template) */
    header {
        page: title-page;
        height: 100%;
        padding-top: var(--title-page-margin-top);
        padding-bottom: var(--title-page-margin-bottom);
        break-after: page;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    /* Regla legacy eliminada: header:has(.publisher)... ya no es necesaria
       porque el template decide si renderizar header o no */

    header .metadata {
        width: 80%;
        margin-left: auto;
        margin-right: auto;
        margin-top: 1.5rem;
        font-size: var(--copyright-font-size);
        text-align: center;
    }

    header .metadata p {
        text-align: center;
        text-indent: 0;
        margin: 0;
    }

    header .title_and_authors {
        width: 100%;
        max-width: var(--title-page-max-width);
    }

    /* En modo completo, empuja title_and_authors hacia arriba */
    header:has(.publisher) .title_and_authors {
        margin-bottom: auto;
    }

    header .title {
        font-variant: var(--title-font-variant);
        font-size: 140%;
    }

    header .author {
        margin-top: 1em;
        font-variant: var(--author-font-variant);
    }

    header .publisher {
        width: 100%;
        max-width: var(--title-page-max-width);
        font-variant: small-caps;
        font-size: 0.9rem;
    }

    h1 {
        text-align: var(--h1-text-align);
        font-variant: small-caps;
        font-size: 1.2em;
        margin-top: 1.5em;
        margin-bottom: 0.8em;
    }

    h2 {
        text-align: var(--h2-text-align);
        font-size: 1.1em;
        margin-top: 1.2em;
        margin-bottom: 0.6em;
    }

    h3 {
        text-align: left;
        font-size: 1.15em;
        font-weight: normal;
        font-variant: small-caps;
        margin-top: 1.2em;
        margin-bottom: 0.4em;
    }

    h4 {
        text-align: left;
        font-size: 1.1em;
        font-style: italic;
        font-weight: normal;
        margin-top: 1em;
        margin-bottom: 0.3em;
    }

    h5 {
        text-align: left;
        font-size: 1.05em;
        font-weight: normal;
        font-variant: small-caps;
        margin-top: 0.8em;
        margin-bottom: 0.3em;
    }

    h6 {
        text-align: left;
        font-size: 1em;
        font-variant: small-caps;
        font-weight: normal;
        margin-top: 0.8em;
        margin-bottom: 0.3em;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        page-break-after: avoid;
        break-after: avoid;
    }

    h1+h2 {
        break-before: avoid;
    }

    /* Solo las secciones después de la primera tienen salto de página */
    section~section {
        break-before: page;
    }

    strong,
    b {
        font-variant: small-caps;
        font-weight: normal;
    }

    /* =========================================
       CONTROL DE PAGINACIÓN (VIUDAS Y HUÉRFANAS)
       ========================================= */

    /* Caso C: Párrafos intermedios (Regla general balanceada) */
    p {
        orphans: 2 !important;
        widows: 2 !important;
        text-align: justify;
    }

    /* Caso B: Último párrafo de bloque (antes de separador o cambio de sección)
       Prioridad: Evitar pocas líneas sueltas al INICIO de la nueva página.
       Efecto: Párrafos cortos (< 4 líneas) saltarán enteros a la siguiente página. */
    p:not(:has(+ p)) {
        orphans: 2 !important;
        widows: 4 !important;
    }

    /* Caso A: Primer párrafo de bloque (después de título o separador) 
       Prioridad: Evitar dejar pocas líneas sueltas al FINAL de la página anterior. */
    hr + p,
    h1 + p,
    h2 + p {
        orphans: 4 !important;
        widows: 2 !important;
    }

    /* Sangría */
    main p {
        margin: 0;
        text-indent: 0;
    }

    main p+p {
        text-indent: 1.5em;
    }

    /* Estilo alternativo: párrafos separados sin sangría */
    body.paragraph-spaced {
        main p {
            margin-bottom: 1em;
        }
        
        /* no solo p+p, porque entonces no se aplicaría tras un salto de página */
        main p {
            text-indent: 0 !important;
        }
    }

    hr,
    .hr {
        border: 0;
        height: 1rem;
    }

    img {
        max-width: 100%;
    }

    h1.no-title, .no-title h1 {
        display: none;
    }

    /* Made With Page */
    .made-with-page {
        break-before: page;
        height: 100%;
        /* Changed from 100vh to 100% */
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: center;
        text-align: center;
        padding-bottom: 4rem;
        box-sizing: border-box;
    }

    .made-with-logo {
        width: 24px;
        /* Balanced for mobile */
        height: auto;
        margin-bottom: 0.8rem;
        opacity: 0.8;
    }

    .made-with-text {
        font-size: 0.75rem;
        color: #888;
        margin: 0;
    }
}

/* Estilos de sección 
  (desde maquetaco se pueden elegir estas opciones, son una serie de clases predefinidas
  que sobreescriben los estilos por defecto).
  Los de ancho, alineación y párrafos son iguales en todas las plantillas.
  Los de centrado vertical requieren ajustar el alto de la página, (y para epub se convierte el contenido en <table> para asegurar compatibilidad)
*/
/* ancho de columna */
section:has(>h1.narrow), section.narrow {
    padding-left: 20%;
    padding-right: 20%;
}
section:has(>h1.right-column), section.right-column {
    padding-left: 25%;
}

/* alineación de texto, por defecto justify*/
section:has(>h1.text-left) p, section.text-left p {
    text-align: left;
}
section:has(>h1.text-center) p, section.text-center p {
    text-align: center;
}
section:has(>h1.text-right) p, section.text-right p {
    text-align: right;
}
/* tamaño de texto, el tamaño de texto se aplica a p, no al propio título */
section:has(>h1.text-small), section.text-small {
    font-size: 0.8rem;
}
section:has(>h1.text-large), section.text-large {
    font-size: 1.2rem;
}
/* separación de párrafos, por defecto es sin separación y con sangría */
section.paragraph-spaced p+p, .preview-content.paragraph-spaced p+p {
    text-indent: 0;
    margin-bottom: 1em;    
}

/* Alineación vertical, esto solo tiene efecto si el contenido cabe en una sola página */
/* Alineación vertical, esto solo tiene efecto si el contenido cabe en una sola página */
main:has(.vcenter), main:has(.vbottom) {
    height: 100%; /* necesario con paged.js porque por defecto no ocupa todo. así además mantiente los márgentes de la página */
}
section:has(>h1.vcenter), section.vcenter {
    display: flex;
    flex-direction: column;
    justify-content: center;
    height: 100%;
}
section:has(>h1.vcenter) h1, h1.vcenter {
    margin-top: -5rem; /* para que el no cuente en el centrado */
}
section:has(>h1.vbottom), section.vbottom {
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    height: 100%;
}
/* -- hasta aquí sección especiales ------------------------------------------------ */


/* ESTILOS INTERFAZ PAGED.JS (PREVIEW) */
@media screen,
pagedjs-ignore {
    body {
        background-color: gray;
    }

    .pagedjs_page {
        background-color: white;
        box-shadow: 0 0 0 1px #cfcfcf;
        margin: 10mm auto;
    }

    .pagedjs_first_page {
        margin-left: auto;
        /* Centrado para single-page view */
    }
}